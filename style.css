/* --- Base & Variables --- */
:root {
    /* ... (Variables remain the same as the last version) ... */
    --font-family-sans: 'Inter', sans-serif;
    --font-family-serif: 'Playfair Display', serif;

    /* Light Theme */
    --bg-main-light: #fdfdfd;
    --bg-noise-opacity-light: 0.02;
    --bg-container-light: #ffffff;
    --bg-sidebar-light: rgba(245, 248, 247, 0.9);
    --sidebar-blur-light: 8px;
    --text-primary-light: #2c3e50;
    --text-secondary-light: #7f8c8d;
    --text-headings-light: #16a085;
    --accent-primary-light: #1abc9c;
    --accent-secondary-light: #e67e22;
    --accent-hover-light: #16a085;
    --delete-hover-bg-light: rgba(230, 126, 34, 0.1);
    --border-light: #ecf0f1;
    --shadow-light: rgba(44, 62, 80, 0.1);
    --icon-light: #7f8c8d;
    --completed-light: #bdc3c7;
    --progress-bg-light: #ecf0f1;
    --empty-state-icon-light: #e0e6e6;

    /* Dark Theme */
    --bg-main-dark: #22272d;
    --bg-noise-opacity-dark: 0.03;
    --bg-container-dark: #2d333b;
    --bg-sidebar-dark: rgba(34, 39, 45, 0.9);
    --sidebar-blur-dark: 10px;
    --text-primary-dark: #cdd9e5;
    --text-secondary-dark: #84919e;
    --text-headings-dark: #2ecc71;
    --accent-primary-dark: #27ae60;
    --accent-secondary-dark: #f39c12;
    --accent-hover-dark: #2ecc71;
    --delete-hover-bg-dark: rgba(243, 156, 18, 0.1);
    --border-dark: #414a53;
    --shadow-dark: rgba(0, 0, 0, 0.25);
    --icon-dark: #84919e;
    --completed-dark: #707c87;
    --progress-bg-dark: #414a53;
    --empty-state-icon-dark: #535e69;

    /* Default Assignments (Light Theme) */
    --bg-main: var(--bg-main-light);
    --bg-noise-opacity: var(--bg-noise-opacity-light);
    --bg-container: var(--bg-container-light);
    --bg-sidebar: var(--bg-sidebar-light);
    --sidebar-blur: var(--sidebar-blur-light);
    --text-primary: var(--text-primary-light);
    --text-secondary: var(--text-secondary-light);
    --text-headings: var(--text-headings-light);
    --accent-primary: var(--accent-primary-light);
    --accent-secondary: var(--accent-secondary-light);
    --accent-hover: var(--accent-hover-light);
    --delete-hover-bg: var(--delete-hover-bg-light);
    --border: var(--border-light);
    --shadow: var(--shadow-light);
    --icon-color: var(--icon-light);
    --completed-color: var(--completed-light);
    --progress-bg: var(--progress-bg-light);
    --empty-state-icon: var(--empty-state-icon-light);

    --border-radius: 10px;
    --border-radius-large: 16px;
    --spacing-unit: 1rem;
    --transition-speed: 0.3s ease; /* Default ease */
    --transition-bounce: cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Bouncy ease */
    --transition-smooth: cubic-bezier(0.25, 0.8, 0.25, 1); /* Smooth ease */
    --header-height: 65px;
    --footer-height: 45px;
}

/* Apply Dark Theme */
body.dark-theme { /* ... (assignments remain same) ... */
    --bg-main: var(--bg-main-dark);
    --bg-noise-opacity: var(--bg-noise-opacity-dark);
    --bg-container: var(--bg-container-dark);
    --bg-sidebar: var(--bg-sidebar-dark);
    --sidebar-blur: var(--sidebar-blur-dark);
    --text-primary: var(--text-primary-dark);
    --text-secondary: var(--text-secondary-dark);
    --text-headings: var(--text-headings-dark);
    --accent-primary: var(--accent-primary-dark);
    --accent-secondary: var(--accent-secondary-dark);
    --accent-hover: var(--accent-hover-dark);
    --delete-hover-bg: var(--delete-hover-bg-dark);
    --border: var(--border-dark);
    --shadow: var(--shadow-dark);
    --icon-color: var(--icon-dark);
    --completed-color: var(--completed-dark);
    --progress-bg: var(--progress-bg-dark);
    --empty-state-icon: var(--empty-state-icon-dark);
}

/* --- Base Styles & Noise Texture --- */
* { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; }

body {
    font-family: var(--font-family-sans);
    background-color: var(--bg-main);
    color: var(--text-primary);
    line-height: 1.6;
    transition: background-color var(--transition-speed), color var(--transition-speed);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
}
/* Disable transitions on initial load */
body.preload * { transition: none !important; }

body::before { /* Noise */
    content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="1"/></svg>');
    opacity: var(--bg-noise-opacity);
    pointer-events: none; z-index: -1; transition: opacity var(--transition-speed);
}

ul { list-style: none; }
a { text-decoration: none; color: inherit; }

button, input {
    font-family: inherit; font-size: 1rem; border: 1px solid var(--border);
    border-radius: var(--border-radius); padding: calc(var(--spacing-unit) * 0.7) calc(var(--spacing-unit) * 1);
    transition: all var(--transition-speed); background-color: transparent; color: var(--text-primary);
}
button { cursor: pointer; display: inline-flex; align-items: center; gap: calc(var(--spacing-unit) * 0.4); border-color: transparent; }
input:focus { border-color: var(--accent-primary); outline: none; }
body.light-theme input:focus { box-shadow: 0 0 0 3px rgba(26, 188, 156, 0.15); }
body.dark-theme input:focus { box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.2); }

/* Subtle animation for button clicks */
button:active {
    transform: scale(0.97);
    filter: brightness(0.95);
    transition: transform 0.1s ease, filter 0.1s ease;
}


i.bx { font-size: 1.3em; vertical-align: middle; }

/* --- App Header --- */
.app-header { /* ... (styles mostly same) ... */
    height: var(--header-height); background-color: var(--bg-container); border-bottom: 1px solid var(--border);
    padding: 0 calc(var(--spacing-unit) * 1.5); /* Adjusted padding */
    display: flex; align-items: center; justify-content: space-between;
    width: 100%; position: sticky; top: 0; z-index: 100; box-shadow: 0 3px 10px var(--shadow);
    transition: background-color var(--transition-speed), border-color var(--transition-speed);
}
.header-content { display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 1500px; margin: 0 auto; }
.logo { /* ... (styles same) ... */
    font-family: var(--font-family-serif); font-size: 1.7rem; font-weight: 700; display: flex; align-items: center; gap: calc(var(--spacing-unit) * 0.6); color: var(--text-headings); text-shadow: 1px 1px 2px rgba(0,0,0,0.05);
}
.logo i { color: var(--accent-primary); transition: transform 0.3s var(--transition-bounce); }
.logo:hover i { transform: rotate(-15deg) scale(1.1); } /* Animate logo icon */

.main-nav { display: flex; gap: calc(var(--spacing-unit) * 2); }
.nav-link { color: var(--text-secondary); font-weight: 500; padding: calc(var(--spacing-unit)*0.5) 0; position: relative; letter-spacing: 0.5px; transition: color var(--transition-speed); }
.nav-link::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 2px; background-color: var(--accent-primary); transition: width var(--transition-speed); }
.nav-link:hover, .nav-link.active { color: var(--text-primary); }
.nav-link:hover::after, .nav-link.active::after { width: 100%; }
.header-actions { display: flex; align-items: center; gap: calc(var(--spacing-unit) * 1.2); }
.theme-toggle-btn { background: none; border: none; font-size: 1.6rem; cursor: pointer; color: var(--icon-color); padding: 0.3rem; border-radius: 50%; transition: color var(--transition-speed), transform 0.3s var(--transition-bounce); } /* Updated transition */
.theme-toggle-btn:hover { color: var(--accent-secondary); transform: rotate(25deg) scale(1.1); } /* More spin */
.user-profile i { font-size: 2rem; color: var(--icon-color); opacity: 0.8; }

/* Mobile Menu Toggle Button */
.mobile-menu-toggle {
    display: none; /* Hidden by default */
    background: none; border: none; font-size: 1.8rem; color: var(--icon-color); padding: 0.3rem;
}

/* --- Sidebar Overlay --- */
.sidebar-overlay {
    position: fixed; inset: 0; /* Cover whole screen */
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 998; /* Below sidebar, above content */
    opacity: 0;
    visibility: hidden; /* Use visibility for better performance */
    transition: opacity var(--transition-speed), visibility var(--transition-speed);
}
.sidebar-overlay.active {
    opacity: 1;
    visibility: visible;
}

/* --- App Wrapper --- */
.app-wrapper { flex-grow: 1; display: flex; justify-content: center; padding: calc(var(--spacing-unit) * 2); width: 100%; }

/* --- App Container --- */
.app-container { display: flex; background-color: var(--bg-container); border-radius: var(--border-radius-large); box-shadow: 0 8px 30px var(--shadow); overflow: hidden; width: 100%; max-width: 1500px; border: 1px solid var(--border); min-height: calc(100vh - var(--header-height) - var(--footer-height) - (var(--spacing-unit) * 4)); }

/* --- Sidebar --- */
.sidebar {
    width: 300px; background-color: var(--bg-sidebar); border-right: 1px solid var(--border); padding: calc(var(--spacing-unit) * 1.8);
    display: flex; flex-direction: column; transition: background-color var(--transition-speed), border-color var(--transition-speed), transform var(--transition-speed); /* Added transform transition */
    flex-shrink: 0; position: relative; /* Needed for close button */

    /* Glass effect */
    @supports (backdrop-filter: blur(var(--sidebar-blur))) or (-webkit-backdrop-filter: blur(var(--sidebar-blur))) {
        backdrop-filter: blur(var(--sidebar-blur)); -webkit-backdrop-filter: blur(var(--sidebar-blur));
    }
}

/* Sidebar Close Button (Mobile) */
.sidebar-close-btn {
    display: none; /* Hidden by default */
    position: absolute;
    top: calc(var(--spacing-unit) * 0.8);
    right: calc(var(--spacing-unit) * 0.8);
    background: none; border: none; font-size: 1.8rem; color: var(--icon-color); padding: 0.3rem;
    z-index: 10; /* Above other sidebar content */
}
.sidebar-close-btn:hover { color: var(--accent-secondary); }

.sidebar-header { margin-bottom: calc(var(--spacing-unit) * 1.5); padding-bottom: var(--spacing-unit); border-bottom: 1px solid var(--border); opacity: 0.9; text-align: center; }
.sidebar h2 { font-family: var(--font-family-serif); font-weight: 700; color: var(--text-headings); font-size: 1.5rem; }
.category-list { flex-grow: 1; overflow-y: auto; /* Allow scrolling within list */ }
.category-list li { padding: calc(var(--spacing-unit) * 0.9) var(--spacing-unit); margin-bottom: calc(var(--spacing-unit) * 0.5); cursor: pointer; border-radius: var(--border-radius); color: var(--text-secondary); font-weight: 500; display: flex; justify-content: space-between; align-items: center; transition: all var(--transition-speed); border: 1px solid transparent; position: relative; overflow: hidden; }
.category-list li::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background-color: var(--accent-primary); opacity: 0.1; transition: left var(--transition-speed); z-index: -1; }
.category-list li:hover::before { left: 0; }
.category-list li:hover { color: var(--text-primary); border-color: var(--border); transform: translateX(5px); }
.category-list li.active { background-color: var(--accent-primary); color: white; font-weight: 600; border-color: transparent; box-shadow: 0 4px 10px var(--shadow); }
.category-list li.active::before { display: none; }
.category-list li.active:hover { transform: none; }
.category-list li.active .category-count { background-color: rgba(255, 255, 255, 0.25); color: white; }
.category-name { flex-grow: 1; margin-right: var(--spacing-unit); }
.category-count { font-size: 0.75rem; background-color: var(--progress-bg); color: var(--text-secondary); padding: 0.15rem 0.6rem; border-radius: 12px; font-weight: 600; min-width: 22px; text-align: center; transition: background-color var(--transition-speed), color var(--transition-speed); }

/* --- Main Content --- */
.main-content { flex: 1; padding: calc(var(--spacing-unit) * 2.5); display: flex; flex-direction: column; overflow-y: auto; }
.main-header { margin-bottom: var(--spacing-unit); border-bottom: none; padding-bottom: 0; position: relative; }
.main-header h1 { font-family: var(--font-family-serif); font-weight: 700; font-size: 2.5rem; color: var(--text-headings); margin-bottom: calc(var(--spacing-unit) * 0.8); text-align: center; text-shadow: 1px 1px 2px rgba(0,0,0,0.05); }
.progress-container { width: 100%; background-color: var(--progress-bg); border-radius: var(--border-radius); overflow: hidden; height: 10px; margin-bottom: calc(var(--spacing-unit) * 0.4); margin-top: calc(var(--spacing-unit) * 0.8); box-shadow: inset 0 1px 2px rgba(0,0,0,0.1); }
.progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary)); border-radius: var(--border-radius); transition: width 0.6s var(--transition-smooth); } /* Smoother progress */
.progress-text { font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; text-align: right; }
.welcome-message { font-size: 1rem; color: var(--text-secondary); margin: var(--spacing-unit) 0 calc(var(--spacing-unit) * 2) 0; text-align: center; padding: calc(var(--spacing-unit)); background-color: rgba(var(--accent-primary-light), 0.05); border-radius: var(--border-radius); border-left: 4px solid var(--accent-primary); opacity: 0; animation: fadeIn 0.5s var(--transition-speed) forwards; } /* Fade in */
body.dark-theme .welcome-message { background-color: rgba(var(--accent-primary-dark), 0.1); }

@keyframes fadeIn { to { opacity: 1; } }

/* Add Task Form */
.add-task-form { display: flex; gap: var(--spacing-unit); margin-bottom: calc(var(--spacing-unit) * 2.5); }
#new-task-input { flex-grow: 1; background-color: var(--bg-container); border: 1px solid var(--border); color: var(--text-primary); padding: calc(var(--spacing-unit) * 0.8) calc(var(--spacing-unit) * 1); box-shadow: inset 0 1px 4px rgba(0,0,0,0.06); border-radius: var(--border-radius); transition: all var(--transition-speed); }
.add-btn { background-color: var(--accent-primary); color: white; font-weight: 600; padding: calc(var(--spacing-unit) * 0.8) calc(var(--spacing-unit) * 1.5); border: none; border-radius: var(--border-radius); box-shadow: 0 3px 8px var(--shadow); transition: all 0.2s ease-out; }
.add-btn i { font-size: 1.4em; transition: transform 0.3s ease; }
.add-btn:hover i { transform: rotate(90deg); } /* Rotate plus icon on hover */
.add-btn:hover { background-color: var(--accent-hover); box-shadow: 0 5px 12px var(--shadow); transform: translateY(-2px); }

/* Task List Container & Empty State */
.task-list-container { flex-grow: 1; position: relative; }
.empty-state { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: var(--text-secondary); opacity: 0; animation: fadeIn 0.5s 0.2s forwards; } /* Fade in empty state too */
.empty-state i { font-size: 4.5rem; color: var(--empty-state-icon); margin-bottom: var(--spacing-unit); }
.empty-state p { font-size: 1.1rem; font-weight: 500; }

/* Task Item Styles */
.task-item { background-color: var(--bg-container); border: 1px solid var(--border); border-left: 4px solid var(--border); border-radius: var(--border-radius); padding: var(--spacing-unit); margin-bottom: var(--spacing-unit); display: flex; align-items: center; gap: var(--spacing-unit); transition: all var(--transition-speed), opacity 0.3s ease-out, transform 0.3s ease-out; box-shadow: 0 2px 5px var(--shadow); cursor: grab; position: relative; /* Animations are handled by JS now */ }
.task-item:hover { border-left-color: var(--accent-secondary); box-shadow: 0 4px 10px var(--shadow); transform: translateY(-2px) scale(1.01); /* Add subtle scale */ }
.task-item.completed { opacity: 0.65; background-color: transparent; border-left-color: var(--completed-color); box-shadow: none; }
.task-item.completed:hover { transform: none; box-shadow: none; border-left-color: var(--completed-color); }
.task-item.completed .task-text { text-decoration: line-through; color: var(--completed-color); }
.task-item input[type="checkbox"] { appearance: none; min-width: 22px; width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 6px; cursor: pointer; position: relative; flex-shrink: 0; transition: all var(--transition-speed); margin-top: 1px; background-color: var(--bg-main); }
.task-item input[type="checkbox"]:hover { border-color: var(--accent-primary); }
.task-item input[type="checkbox"]:checked { background-color: var(--accent-primary); border-color: var(--accent-primary); animation: pop 0.25s var(--transition-bounce); } /* Use bouncy ease */
@keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.25); } 100% { transform: scale(1); } } /* More pop */
.task-item input[type="checkbox"]:checked::after { content: ''; position: absolute; left: 7px; top: 3px; width: 5px; height: 11px; border: solid white; border-width: 0 3px 3px 0; transform: rotate(45deg); }
.task-text { flex-grow: 1; font-weight: 500; color: var(--text-primary); }
.delete-btn { background: none; border: none; color: var(--icon-color); font-size: 1.5rem; padding: 0.3rem; border-radius: 50%; opacity: 0; transform: scale(0.8); transition: all var(--transition-speed); line-height: 1; }
.task-item:hover .delete-btn { opacity: 0.6; transform: scale(1); }
.delete-btn:hover { opacity: 1; color: var(--accent-secondary); background-color: var(--delete-hover-bg); transform: scale(1.15) rotate(15deg); } /* More scale/rotate */

/* SortableJS Dragging Styles */
.task-item.sortable-ghost { opacity: 0.4; background: var(--bg-main); border: 2px dashed var(--accent-primary); border-left-width: 2px; box-shadow: none; }
.task-item.sortable-chosen { cursor: grabbing; box-shadow: 0 8px 20px var(--shadow); transform: scale(1.04) translateY(-1px); border-color: var(--accent-primary); border-left-color: var(--accent-primary); }

/* --- App Footer --- */
.app-footer { height: var(--footer-height); text-align: center; padding: var(--spacing-unit) 0; color: var(--text-secondary); font-size: 0.9rem; border-top: 1px solid var(--border); background-color: var(--bg-container); width: 100%; margin-top: auto; }

/* --- Responsiveness Adjustments --- */
@media (max-width: 992px) {
    .sidebar { width: 260px; }
    .main-nav { display: none; }
    .main-header h1 { font-size: 2rem; }
    .mobile-menu-toggle { display: block; /* Show menu button */ }
    .app-header { padding: 0 var(--spacing-unit); } /* Adjust padding for menu button */
    .header-content { gap: var(--spacing-unit); justify-content: space-between; } /* Ensure space */
    .logo { margin-right: auto; } /* Push logo left */
    .logo-text { display: none; } /* Hide text logo */
}

@media (max-width: 768px) {
    body::before { display: none; }
    .app-wrapper { padding: 0; padding-top: var(--header-height); /* Account for fixed header */ }
    .app-container {
        flex-direction: column; border-radius: 0; /* Full width */
        border: none; box-shadow: none; max-width: 100%;
        min-height: calc(100vh - var(--header-height) - var(--footer-height));
    }

    /* Mobile Sidebar (Off-Canvas) */
    .sidebar {
        position: fixed; /* Fixed position */
        top: 0;
        left: 0;
        width: 280px; /* Fixed width when open */
        height: 100%; /* Full height */
        z-index: 1000; /* Above overlay */
        transform: translateX(-100%); /* Hidden by default */
        border-right: 1px solid var(--border);
        border-radius: 0;
        box-shadow: 5px 0 15px rgba(0,0,0,0.1);
        /* Glass effect is kept from base .sidebar styles */
        overflow-y: auto; /* Allow scrolling */
        padding-top: calc(var(--header-height) * 0.8); /* Space for close button */
    }
    .sidebar.active {
        transform: translateX(0%); /* Slide in */
    }
    .sidebar-close-btn { display: block; /* Show close button */ }

    .main-content { padding: calc(var(--spacing-unit) * 1.5); flex-grow: 1; }
    .main-header h1 { font-size: 1.8rem; }
    .welcome-message { font-size: 0.9rem; margin: calc(var(--spacing-unit)*0.5) 0 var(--spacing-unit) 0; }
    .add-task-form { margin-bottom: var(--spacing-unit); }
    .add-btn span { display: none; }
    .add-btn { padding: calc(var(--spacing-unit)*0.7); }

    /* Adjust header for mobile */
    .app-header { padding: 0 var(--spacing-unit); }
    .logo i { font-size: 1.6rem; } /* Slightly smaller logo icon */
    .header-actions { gap: calc(var(--spacing-unit)*0.5); } /* Less gap */
    .user-profile i { font-size: 1.8rem; }
}